!function(e){function t(n){if(a[n])return a[n].exports;var r=a[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){"use strict";var n=a(1),r=a(2),i=a(3),s=a(5);ReactDOM.render(n.createElement(r,null),document.getElementById("navbar-brand")),ReactDOM.render(n.createElement(i,null),document.getElementById("login")),ReactDOM.render(n.createElement(s,null),document.getElementById("root"))},function(e,t){e.exports=React},function(e,t,a){"use strict";var n=a(1),r=n.createClass({displayName:"HomeButton",render:function(){return n.createElement("a",{href:"#home",onClick:this._onClick},"Voters")},_onClick:function(){PubSub.publish("on_homebutton_click")}});e.exports=r},function(e,t,a){"use strict";var n=a(1),r=a(4),i=n.createClass({displayName:"LoginButton",mixins:[r],_onCreatepollClick:function(){PubSub.publish("on_create_pollbutton_click")},render:function(){return null!==this._getCookie("token")?(window.isUserAuthed=!0,n.createElement("div",{className:"right-menu"},n.createElement("a",{href:"/signout",className:"buttonLogin"},"Sign Out"),n.createElement("a",{onClick:this._onCreatepollClick,href:"#createpoll",className:"createPollButton"},n.createElement("i",{className:"fa fa-plus fa-2x"})))):(window.isUserAuthed=!1,n.createElement("a",{href:"https://github.com/login/oauth/authorize?client_id=c73864bb2fa3040f875e",className:"buttonLogin"},n.createElement("i",{className:"fa fa-github"})," Sign in with Github"))}});e.exports=i},function(e,t){"use strict";var a={_getCookie:function(e){var t=document.cookie,a=e+"=",n=t.indexOf("; "+a);if(-1==n){if(n=t.indexOf(a),0!=n)return null}else{n+=2;var r=document.cookie.indexOf(";",n);-1==r&&(r=t.length)}return unescape(t.substring(n+a.length,r))}};e.exports=a},function(e,t,a){"use strict";var n=a(1),r=a(6),i=a(7),s=a(9),l=n.createClass({displayName:"App",_setRoute:function(){this.route={"default":"home",poll_id:"detail",createpoll:"createpoll"},this.authorizedOnlyRoutes=["createpoll"]},getInitialState:function(){return{dataset:[],currentPage:"",selectedItem:-1}},_getPollingList:function(e,t){if(this.state.dataset.length>0&&!t)e(this.state.dataset);else{var a=this;a.setState({currentPage:"loading"}),$.ajax({method:"GET",url:"/findAllPoll",success:function(t){e(JSON.parse(t))},error:function(e,t){a.setState({currentPage:"error"})}})}},componentWillMount:function(){var e=this;this.pubsub_token=PubSub.subscribe("on_homebutton_click",function(){this._getPollingList(function(t){e.setState({currentPage:"home",dataset:t})})}.bind(this)),this.pubsub_token=PubSub.subscribe("on_create_pollbutton_click",function(){this.setState({currentPage:"createpoll"})}.bind(this)),this.pubsub_token=PubSub.subscribe("request_loading_page",function(){this.setState({currentPage:"loading"})}.bind(this)),this.pubsub_token=PubSub.subscribe("request_error_page",function(){this.setState({currentPage:"error"})}.bind(this)),this.pubsub_token=PubSub.subscribe("delete_button_clicked",function(t,a){e._onDelete(a)}.bind(this)),this.pubsub_token=PubSub.subscribe("on_createpoll_succeed",function(){this._getPollingList(function(t){window.location.hash="#detail#poll_id="+(t.length-1),e.setState({currentPage:"detail",dataset:t,selectedItem:t.length-1})},!0)}.bind(this)),this._setRoute();var t="";for(var a in this.route)if(window.location.hash.includes(a)){t=this.route[a];break}t=""==t?this.route["default"]:t,"home"==t?this._getPollingList(function(a){e.setState({currentPage:t,dataset:a})}):"detail"==t?this._getPollingList(function(a){e.setState({dataset:a,currentPage:t,selectedItem:window.location.hash.split("=")[1]})}):this.setState({currentPage:t})},_onDelete:function(e){if(1==confirm("Are you sure you want to delete this poll?")){var t=this.state.dataset[e]._id;this.setState({currentPage:"loading"});var a=this;$.ajax({method:"DELETE",url:"/deletepoll",data:{id:t},success:function(){a._getPollingList(function(e){a.setState({currentPage:"home",dataset:e})},!0)},error:function(){this.setState({currentPage:"error"})}})}},_onSeePollingDetailClick:function(e){this.setState({currentPage:"detail",selectedItem:e})},_onHomeButtonClick:function(){this.setState({currentPage:"home"})},_getCookie:function(e){var t=document.cookie,a=e+"=",n=t.indexOf("; "+a);if(-1==n){if(n=t.indexOf(a),0!=n)return null}else{n+=2;var r=document.cookie.indexOf(";",n);-1==r&&(r=t.length)}return unescape(t.substring(n+a.length,r))},_hasAccess:function(){var e=this.state.currentPage;return this.authorizedOnlyRoutes.indexOf(e)>-1?!!window.isUserAuthed:!0},render:function(){if(!this._hasAccess())return n.createElement("div",null,n.createElement("h1",null,"403!"),n.createElement("p",null,"You're not authorized to perform this action. Please login first"));var e=this,t=this.state.dataset;if("home"==this.state.currentPage)return n.createElement("div",null,t.map(function(t,a){var i=e._onSeePollingDetailClick.bind(e,a);return n.createElement(r,{author:t.author,index:a,see_polling_detail:i,title:t.title,description:t.description})}));if("detail"==this.state.currentPage){var a=this.state.selectedItem,l=e._onHomeButtonClick.bind(this);return n.createElement(i,{index:a,homebutton:l,dataset:t[a]})}return"createpoll"==this.state.currentPage?n.createElement(s,null):"error"==this.state.currentPage?n.createElement("div",null,n.createElement("h1",null,"Error"),n.createElement("p",null,"Sorry, Something is wrong. Please try again")):n.createElement("div",null,n.createElement("h1",null,"Loading..."),n.createElement("p",null,"Please wait"))}});e.exports=l},function(e,t,a){"use strict";var n=a(1),r=a(4),i=n.createClass({displayName:"PollItem",mixins:[r],_getExcerpt:function(e,t,a){t=t||" ";var n=e.split(t);if(n.length<a)return e;for(var r="",i=0;a>i;i++)void 0!==n[i]&&(r+=n[i]+t);return r+"..."},_onDelete:function(){PubSub.publish("delete_button_clicked",this.props.index)},render:function(){var e=[];return this.props.author==this._getCookie("token")&&e.push(n.createElement("a",{onClick:this._onDelete,href:"#",className:"pull-right"},n.createElement("i",{className:"fa fa-trash"}))),n.createElement("div",{className:"panel panel-default"},n.createElement("div",{className:"panel-heading"},n.createElement("h3",{className:"panel-title"},this.props.title,e)),n.createElement("div",{className:"panel-body"},n.createElement("div",{className:"row"},n.createElement("div",{className:"col-xs-12"},this._getExcerpt(this.props.description," ",10),n.createElement("br",null),n.createElement("a",{onClick:this.props.see_polling_detail,href:"#detail#poll_id="+this.props.index},"Click to see detail ",n.createElement("i",{className:"fa fa-chevron-circle-right"}))))))}});e.exports=i},function(e,t,a){"use strict";var n=a(1),r=a(4),i=a(8),s=n.createClass({displayName:"PollDetail",mixins:[r],_onFormSubmit:function(e){console.log("data object = "+e);var t=this.props.dataset;t.result[e]+=1,$.ajax({url:"/vote",data:{vote:e,_id:t._id},method:"PUT",success:function(e){},error:function(e,t){self.setState({pagestate:"error",message:t})}}),this.setState({dataset:t})},getInitialState:function(){return{dataset:this.props.dataset}},_onDeleteLinkClicked:function(){PubSub.publish("delete_button_clicked",this.props.index)},render:function(){var e=this.state.dataset.result,t=0;for(var a in e)t+=e[a];var r=[],s=[];s.push(n.createElement("option",{value:"-"},"-- Select your vote --"));var l=0;for(var a in e){s.push(n.createElement("option",{value:a},a.toUpperCase()));var o="graphcolor"+l,c=0;0!==e[a]&&0!==t&&(c=(100*e[a]/t).toFixed(2));var u=c;1>u&&(u=1);var m={width:u+"%"};r.push(n.createElement("div",null,n.createElement("div",{style:m,className:o}),n.createElement("div",{className:"legend"},a.toUpperCase()+" : "+c+"%"))),l++}var d=window.location,p=d.protocol+"//"+d.host+"/"+d.pathname.split("/")[1],h=encodeURIComponent(p+"#detail#poll_id="+this.props.index),f="https://twitter.com/intent/tweet?text="+this.props.dataset.title+" Check out the vote result : "+h,b=[];this.props.dataset.author==this._getCookie("token")&&b.push(n.createElement("a",{onClick:this._onDeleteLinkClicked,href:"#",className:"deletePollLink"},n.createElement("i",{className:"fa fa-trash"})," Click to delete this poll"));var g=this._onFormSubmit.bind(this);return n.createElement("div",null,n.createElement("ol",{className:"breadcrumb"},n.createElement("li",null,n.createElement("a",{onClick:this.props.homebutton,href:"#home"},"Home")),n.createElement("li",null,this.props.dataset.title)),b,n.createElement("br",null),n.createElement("h1",{className:"title"},this.props.dataset.title),n.createElement("div",{className:"row"},n.createElement("div",{className:"col-md-4"},n.createElement(i,{onFormSubmit:g,index:this.props.index,options:s,dataset:this.props.dataset}),n.createElement("br",null),n.createElement("a",{target:"_blank",href:f,className:"buttonShare"},n.createElement("i",{className:"fa fa-twitter"})," Tweet this to your followers"),n.createElement("br",null),n.createElement("br",null),this.props.dataset.description),n.createElement("div",{className:"col-md-8"},n.createElement("h3",null,"Poll Result (",t," votes): "),r)))}});e.exports=s},function(e,t,a){"use strict";var n=a(1),r=a(4),i=n.createClass({displayName:"VoteForm",mixins:[r],componentWillMount:function(){var e=!1;if(window.isUserAuthed){var t=this.props.dataset.username_voters,a=this._getCookie("token");t.indexOf(a)<0&&(e=!0)}else{var n=this.props.dataset.ip_voters,r=this._getCookie("ip_address");n.indexOf(r)<0&&(e=!0)}e||this.setState({pagestate:"voted"})},_processVote:function(e){e.preventDefault(),this.props.onFormSubmit(this.refs.vote.value),this.setState({vote:this.refs.vote.value,pagestate:"voted"})},getInitialState:function(){return{vote:"",pagestate:"active"}},render:function(){return"voted"==this.state.pagestate?n.createElement("form",{ref:"voteform"},n.createElement("select",{disabled:!0,className:"form-control voteDropdown",ref:"vote"},this.props.options),n.createElement("button",{disabled:!0,type:"submit",className:"buttonVote pull-left"},"Vote"),n.createElement("div",{className:"clearfix"}),n.createElement("div",{className:"form-message"},"You've already voted")):n.createElement("form",{ref:"voteform",onSubmit:this._processVote},n.createElement("select",{className:"form-control voteDropdown",ref:"vote"},this.props.options),n.createElement("button",{type:"submit",className:"buttonVote pull-left"},"Vote"),n.createElement("div",{className:"clearfix"}),n.createElement("div",{className:"form-message"},this.props.message))}});e.exports=i},function(e,t,a){"use strict";var n=a(1),r=n.createClass({displayName:"CreatePollForm",_sanitizeInput:function(){for(var e=this.formdata.poll_options.split(","),t=0;t<e.length;t++)""!=e[t].trim()&&(e[t]=e[t].trim());return{title:this.formdata.title.trim(),description:this.formdata.description.trim(),poll_options:e.join(",")}},_validateForm:function(){if(""==this.formdata.title||""==this.formdata.description||""==this.formdata.poll_options)return!1;var e=this.formdata.poll_options.split(",");return!(e.length>=10)},_processForm:function(e){if(e.preventDefault(),this.formdata={title:this.refs.title.value,description:this.refs.description.value,poll_options:this.refs.poll_options.value},this._validateForm()){this.formdata=this._sanitizeInput();var t=this;PubSub.publish("request_loading_page"),$.ajax({method:"POST",url:"/createpoll",data:t.formdata,success:function(e){PubSub.publish("on_createpoll_succeed")},error:function(e,t){PubSub.publish("request_error_page")}})}else alert("form is not valid. Please fill all fields, and make sure poll_options item amount is fewer than 10")},render:function(){return n.createElement("form",{id:"createpoll_form",ref:"createpoll_form",onSubmit:this._processForm},n.createElement("h2",null,"Create New Poll"),n.createElement("div",{className:"input-group"},n.createElement("label",null,"Poll title"),n.createElement("input",{name:"title",ref:"title",type:"text",className:"form-control",placeholder:"E.g : Democrat or Republican?"})),n.createElement("div",{className:"input-group"},n.createElement("label",null,"Description"),n.createElement("input",{name:"description",ref:"description",type:"text",className:"form-control",placeholder:"Explain why anyone should vote"})),n.createElement("div",{className:"input-group"},n.createElement("label",null,"Poll Options (comma separated, maximum 10 items)"),n.createElement("input",{name:"poll_options",ref:"poll_options",type:"text",className:"form-control",placeholder:"E.g : Democrat, Republican, Both"})),n.createElement("br",null),n.createElement("button",{type:"submit",className:"btn btn-primary"},"Submit"))}});e.exports=r}]);