!function(e){function t(a){if(n[a])return n[a].exports;var o=n[a]={exports:{},id:a,loaded:!1};return e[a].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var a=n(1),o=n(2),r=n(3),i=n(5);ReactDOM.render(a.createElement(o,null),document.getElementById("navbar-brand")),ReactDOM.render(a.createElement(r,null),document.getElementById("login")),ReactDOM.render(a.createElement(i,null),document.getElementById("root"))},function(e,t){e.exports=React},function(e,t,n){"use strict";var a=n(1),o=a.createClass({displayName:"HomeButton",render:function(){return a.createElement("a",{href:"#home",onClick:this._onClick},"Voters")},_onClick:function(){PubSub.publish("on_homebutton_click")}});e.exports=o},function(e,t,n){"use strict";var a=n(1),o=n(4),r=a.createClass({displayName:"LoginButton",mixins:[o],_onCreatepollClick:function(){PubSub.publish("on_create_pollbutton_click")},render:function(){return null!==this._getCookie("token")?(window.isUserAuthed=!0,a.createElement("div",{className:"right-menu"},a.createElement("a",{href:"/signout",className:"buttonLogin"},"Sign Out"),a.createElement("a",{onClick:this._onCreatepollClick,href:"#createpoll",className:"createPollButton"},a.createElement("i",{className:"fa fa-plus fa-2x"})))):(window.isUserAuthed=!1,a.createElement("a",{href:"https://github.com/login/oauth/authorize?client_id=c73864bb2fa3040f875e",className:"buttonLogin"},a.createElement("i",{className:"fa fa-github"})," Sign in with Github"))}});e.exports=r},function(e,t){"use strict";var n={_getCookie:function(e){var t=document.cookie,n=e+"=",a=t.indexOf("; "+n);if(-1==a){if(a=t.indexOf(n),0!=a)return null}else{a+=2;var o=document.cookie.indexOf(";",a);-1==o&&(o=t.length)}return unescape(t.substring(a+n.length,o))}};e.exports=n},function(e,t,n){"use strict";var a=n(1),o=n(6),r=n(7),i=n(9),s=n(4),l=n(10),c=a.createClass({displayName:"App",mixins:[s,l],getInitialState:function(){return{dataset:[],currentPage:"",selectedItem:-1}},_getPollingList:function(e,t){var n=JSON.parse(localStorage.getItem("dataset"));if(n.length>0&&!t&&this.state.dataset.length>0)e(n);else{var a=this;$.ajax({method:"GET",url:"/findAllPoll",success:function(t){localStorage.setItem("dataset",t),e(JSON.parse(t))},error:function(e,t){a.setState({currentPage:"error"})}})}},componentWillMount:function(){var e=this;this.pubsub_token=PubSub.subscribe("on_homebutton_click",function(){this._getPollingList(function(t){e.setState({currentPage:"home",dataset:t})})}.bind(this)),this.pubsub_token=PubSub.subscribe("on_create_pollbutton_click",function(){this.setState({currentPage:"createpoll"})}.bind(this)),this.pubsub_token=PubSub.subscribe("request_loading_page",function(){this.setState({currentPage:"loading"})}.bind(this)),this.pubsub_token=PubSub.subscribe("request_error_page",function(){this.setState({currentPage:"error"})}.bind(this)),this.pubsub_token=PubSub.subscribe("delete_button_clicked",function(t,n){e._onDelete(n)}.bind(this)),this.pubsub_token=PubSub.subscribe("on_createpoll_succeed",function(){this._getPollingList(function(t){window.location.hash="#detail#poll_id="+(t.length-1),e.setState({currentPage:"detail",dataset:t,selectedItem:t.length-1})},!0)}.bind(this)),this._setRoute();var t="";for(var n in this.route)if(window.location.hash.includes(n)){t=this.route[n];break}t=""==t?this.route["default"]:t,"home"==t?this._getPollingList(function(t){e.setState({currentPage:"home",dataset:t})}):"detail"==t?this._getPollingList(function(t){e.setState({dataset:t,currentPage:"detail",selectedItem:window.location.hash.split("=")[1]})}):this.setState({currentPage:t})},_onDelete:function(e){if(1==confirm("Are you sure you want to delete this poll?")){var t=this.state.dataset[e]._id;this.setState({currentPage:"loading"});var n=this;$.ajax({method:"DELETE",url:"/deletepoll",data:{id:t},success:function(){n._getPollingList(function(e){n.setState({currentPage:"home",dataset:e})},!0)},error:function(){this.setState({currentPage:"error"})}})}},_onSeePollingDetailClick:function(e){this.setState({currentPage:"detail",selectedItem:e})},_onHomeButtonClick:function(){this.setState({currentPage:"home"})},_onDatasetChange:function(e){this._getPollingList(function(e){},!0)},render:function(){if(!this._hasAccess())return a.createElement("div",null,a.createElement("h1",null,"403!"),a.createElement("p",null,"You're not authorized to perform this action. Please login first"));var e=this,t=JSON.parse(localStorage.getItem("dataset"));if("home"==this.state.currentPage)return a.createElement("div",null,t.map(function(t,n){var r=e._onSeePollingDetailClick.bind(e,n);return a.createElement(o,{author:t.author,index:n,see_polling_detail:r,title:t.title,description:t.description})}));if("detail"==this.state.currentPage){var n=this.state.selectedItem,s=e._onHomeButtonClick.bind(this);return a.createElement(r,{onDatasetChange:this._onDatasetChange.bind(this),index:n,homebutton:s,dataset:t[n]})}return"createpoll"==this.state.currentPage?a.createElement(i,null):"error"==this.state.currentPage?a.createElement("div",null,a.createElement("h1",null,"Error"),a.createElement("p",null,"Sorry, Something is wrong. Please try again")):a.createElement("div",null,a.createElement("h1",null,"Loading..."),a.createElement("p",null,"Please wait"))}});e.exports=c},function(e,t,n){"use strict";var a=n(1),o=n(4),r=a.createClass({displayName:"PollItem",mixins:[o],_getExcerpt:function(e,t,n){t=t||" ";var a=e.split(t);if(a.length<n)return e;for(var o="",r=0;n>r;r++)void 0!==a[r]&&(o+=a[r]+t);return o+"..."},_onDelete:function(){PubSub.publish("delete_button_clicked",this.props.index)},render:function(){var e=[];return this.props.author==this._getCookie("token")&&e.push(a.createElement("a",{onClick:this._onDelete,href:"#",className:"pull-right"},a.createElement("i",{className:"fa fa-trash"}))),a.createElement("div",{className:"panel panel-default"},a.createElement("div",{className:"panel-heading"},a.createElement("h3",{className:"panel-title"},this.props.title,e)),a.createElement("div",{className:"panel-body"},a.createElement("div",{className:"row"},a.createElement("div",{className:"col-xs-12"},this._getExcerpt(this.props.description," ",10),a.createElement("br",null),a.createElement("a",{onClick:this.props.see_polling_detail,href:"#detail#poll_id="+this.props.index},"Click to see detail ",a.createElement("i",{className:"fa fa-chevron-circle-right"}))))))}});e.exports=r},function(e,t,n){"use strict";var a=n(1),o=n(4),r=n(8),i=a.createClass({displayName:"PollDetail",mixins:[o],componentWillMount:function(){this.setState({canvote:this._canUserVote()})},_canUserVote:function(){var e=!1;if(window.isUserAuthed){console.log("user authed");var t=this.props.dataset.username_voters;console.log("username voters = "+t);var n=this._getCookie("token");console.log("token = "+n),t.indexOf(n)<0&&(console.log("yes, i can vote"),e=!0)}else{console.log("user not authed");var a=this.props.dataset.ip_voters;console.log("ip_voters = "+a);var o=this._getCookie("ip_address");console.log("ip_address = "+o),a.indexOf(o)<0&&(console.log("yes, i can vote"),e=!0)}return console.log("CAN USER VOTE = "+e),e},_onFormSubmit:function(e){var t=this;if(void 0!==e.new_option){var n=this.props.dataset;n.result[e.new_option]=1,$.ajax({url:"/vote/new_option",data:{new_option:e.new_option,_id:n._id},method:"PUT",success:function(e){t.props.onDatasetChange()}}),this.setState({dataset:n,canvote:!1})}else{var n=this.props.dataset;n.result[e]+=1,$.ajax({url:"/vote",data:{vote:e,_id:n._id},method:"PUT",success:function(e){var n={index:t.props.index,data:e};t.props.onDatasetChange(n)}}),this.setState({dataset:n,canvote:!1})}},getInitialState:function(){return{dataset:this.props.dataset,canvote:!1}},_onDeleteLinkClicked:function(){PubSub.publish("delete_button_clicked",this.props.index)},render:function(){var e=this.state.dataset.result,t=0;for(var n in e)t+=e[n];var o=[],i=[];i.push(a.createElement("option",{value:"-"},"-- Select your vote --"));var s=0;for(var n in e){i.push(a.createElement("option",{value:n},n.toUpperCase()));var l="graphcolor"+s,c=0;0!==e[n]&&0!==t&&(c=(100*e[n]/t).toFixed(2));var u=c;1>u&&(u=1);var m={width:u+"%"};o.push(a.createElement("div",null,a.createElement("div",{style:m,className:l}),a.createElement("div",{className:"legend"},n.toUpperCase()+" : "+c+"%"))),s++}var p=window.location,d=p.protocol+"//"+p.host+"/"+p.pathname.split("/")[1],h=encodeURIComponent(d+"#detail#poll_id="+this.props.index),f="https://twitter.com/intent/tweet?text="+this.props.dataset.title+" Check out the vote result : "+h,_=[];this.props.dataset.author==this._getCookie("token")&&_.push(a.createElement("a",{onClick:this._onDeleteLinkClicked,href:"#",className:"deletePollLink"},a.createElement("i",{className:"fa fa-trash"})," Click to delete this poll"));var v=this._onFormSubmit.bind(this);return a.createElement("div",null,a.createElement("ol",{className:"breadcrumb"},a.createElement("li",null,a.createElement("a",{onClick:this.props.homebutton,href:"#home"},"Home")),a.createElement("li",null,this.props.dataset.title)),_,a.createElement("br",null),a.createElement("h1",{className:"title"},this.props.dataset.title),a.createElement("div",{className:"row"},a.createElement("div",{className:"col-md-4"},a.createElement(r,{canvote:this.state.canvote,onFormSubmit:v,index:this.props.index,options:i,dataset:this.props.dataset}),a.createElement("br",null),a.createElement("a",{target:"_blank",href:f,className:"buttonShare"},a.createElement("i",{className:"fa fa-twitter"})," Tweet this to your followers"),a.createElement("br",null),a.createElement("br",null),this.props.dataset.description),a.createElement("div",{className:"col-md-8"},a.createElement("h3",null,"Poll Result (",t," votes): "),o)))}});e.exports=i},function(e,t,n){"use strict";var a=n(1),o=a.createClass({displayName:"VoteForm",_processVote:function(e){e.preventDefault(),void 0!==this.refs.new_option&&""!=this.refs.new_option.value?this.props.onFormSubmit({new_option:this.refs.new_option.value}):this.props.onFormSubmit(this.refs.vote.value)},render:function(){if(!this.props.canvote)return a.createElement("form",{ref:"voteform"},a.createElement("div",{className:"form-message"},"You've already voted"));var e=[];return window.isUserAuthed&&e.push(a.createElement("div",{className:"input-group"},a.createElement("br",null),a.createElement("input",{className:"form-control",type:"text",name:"new_option",ref:"new_option",placeholder:"Or, type your own opinion"}))),a.createElement("form",{ref:"voteform",onSubmit:this._processVote},a.createElement("select",{className:"form-control voteDropdown",ref:"vote"},this.props.options),a.createElement("button",{type:"submit",className:"buttonVote pull-left"},"Vote"),a.createElement("div",{className:"clearfix"}),e,a.createElement("div",{className:"form-message"},this.props.message))}});e.exports=o},function(e,t,n){"use strict";var a=n(1),o=a.createClass({displayName:"CreatePollForm",_sanitizeInput:function(){for(var e=this.formdata.poll_options.split(","),t=0;t<e.length;t++)""!=e[t].trim()&&(e[t]=e[t].trim());return{title:this.formdata.title.trim(),description:this.formdata.description.trim(),poll_options:e.join(",")}},_validateForm:function(){if(""==this.formdata.title||""==this.formdata.description||""==this.formdata.poll_options)return!1;var e=this.formdata.poll_options.split(",");return!(e.length>=10)},_processForm:function(e){if(e.preventDefault(),this.formdata={title:this.refs.title.value,description:this.refs.description.value,poll_options:this.refs.poll_options.value},this._validateForm()){this.formdata=this._sanitizeInput();var t=this;PubSub.publish("request_loading_page"),$.ajax({method:"POST",url:"/createpoll",data:t.formdata,success:function(e){PubSub.publish("on_createpoll_succeed")},error:function(e,t){PubSub.publish("request_error_page")}})}else alert("form is not valid. Please fill all fields, and make sure poll_options item amount is fewer than 10")},render:function(){return a.createElement("form",{id:"createpoll_form",ref:"createpoll_form",onSubmit:this._processForm},a.createElement("h2",null,"Create New Poll"),a.createElement("div",{className:"input-group"},a.createElement("label",null,"Poll title"),a.createElement("input",{name:"title",ref:"title",type:"text",className:"form-control",placeholder:"E.g : Democrat or Republican?"})),a.createElement("div",{className:"input-group"},a.createElement("label",null,"Description"),a.createElement("input",{name:"description",ref:"description",type:"text",className:"form-control",placeholder:"Explain why anyone should vote"})),a.createElement("div",{className:"input-group"},a.createElement("label",null,"Poll Options (comma separated, maximum 10 items)"),a.createElement("input",{name:"poll_options",ref:"poll_options",type:"text",className:"form-control",placeholder:"E.g : Democrat, Republican, Both"})),a.createElement("br",null),a.createElement("button",{type:"submit",className:"btn btn-primary"},"Submit"))}});e.exports=o},function(e,t){"use strict";var n={_setRoute:function(){this.route={"default":"home",poll_id:"detail",createpoll:"createpoll"},this.authorizedOnlyRoutes=["createpoll"]},_hasAccess:function(){var e=this.state.currentPage;return this.authorizedOnlyRoutes.indexOf(e)>-1?!!window.isUserAuthed:!0}};e.exports=n}]);